
<!-- SHADERS! :D :D :D 
From: http://www.clicktorelease.com/code/npr-shading/
-->
    <div class="container">
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
		Nice shader: https://www.shadertoy.com/view/MdX3Dr
{% comment %}
  <style>
   .chromeFrameInstallDefaultStyle {
     margin-top: 10px;
     width: 800px;
     border: 5px solid blue;
   }
  </style>
{% endcomment %}
 
	 {% comment %}
  <script src="{{ STATIC_URL }}/meshviewer/js/thingiview/three.min.js"></script>
  <script src="{{ STATIC_URL }}/meshviewer/js/thingiview/thingiview.js"></script>
  <script src="{{ STATIC_URL }}/meshviewer/js/thingiview/thingiloader.js"></script>
<div id="viewer" style="width:500px;height:400px"></div>
      <script>
        window.onload = function() {
          // You may want to place these lines inside an onload handler
          CFInstall.check({
            mode: "inline", // the default
            node: "prompt"
          });

          thingiurlbase = "{{ STATIC_URL }}meshviewer/js/thingiview/";
          thingiview = new Thingiview("viewer", 100, 10);
          thingiview.setObjectColor('#C0D8F0');
          thingiview.setObjectMaterial('solid');
          thingiview.initScene();
          thingiview.setShowPlane(true);
          thingiview.loadSTL("../objects/cube.stl");
        }
        
      </script>
    </div>
	{% endcomment %}
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <script src="{{ STATIC_URL}}/meshviewer/js/jsc3d/jsc3d.min.js"></script>
                <script src="{{ STATIC_URL}}/meshviewer/js/jsc3d/jsc3d.console.js"></script>
                <script>
                $(document).ready(function() {
                    console.log("hello wolrd");
                });
                </script>


        <div id="main_frame" style="width:600px; margin:auto; position:relative; font-size: 9pt; color: #777777;">
            <canvas id="cv" style="border: 1px solid;" width="600" height="300" ></canvas>
            <div id="loading" style="position:absolute; left:90px; top:159px;"></div>
            <div id="control_panel" style="display:block; color:#000000; padding:5px; position:absolute; left:10px; top:325px; background-color:#ffffff; height:22px; width:166px; border-radius:5px; border:1px solid #777777; font-family:Arial,sans-serif; opacity:0.6;"> 
            <input type="radio" name="operate" value="rotate" onclick="viewer.setMouseUsage('rotate');" checked="true">Rotate</input>
            <input type="radio" name="operate" value="zoom" onclick="viewer.setMouseUsage('zoom');">Zoom</input>
            <input type="radio" name="operate" value="pan" onclick="viewer.setMouseUsage('pan');">Pan</input>
            </div>
            <div style="float:left;">
            <select id="model_list">
            <option>teapot.obj</option>
            <option>shoe.obj</option>
            <option>bunny.obj</option>
            <option>buddha.obj</option>
            <option>dragon.stl</option>
            <option>shoelast.obj</option>
            <option>hard_milk.stl</option>
            <option>helicopter.obj</option>
            </select>
            <button id="load" onclick="loadModel();">Load</button>
            </div>
            <div style="float:right;">
            <select id="render_mode_list">
            <option>render as points</option>
            <option>render as wireframe</option>
            <option>render as flat</option>
            <option>render as smooth</option>
            <option>render with environment</option>
            </select>
            <button id="change" onclick="setRenderMode();">Change</button>
            </div>
        </div>
        <!--
        <script type="text/javascript" src="../jsc3d.js"></script>
        <script type="text/javascript" src="../jsc3d.console.js"></script>
        <script type="text/javascript" src="../external/Sonic/sonic.js"></script>
        -->
        <script type="text/javascript">
        JSC3D.console.setup('main_frame', '120px');

        var canvas = document.getElementById('cv');
        var viewer = new JSC3D.Viewer(canvas);
        var logoTimerID = 0;
        var PATH_TO_MODELS = '{{ STATIC_URL }}/meshviewer/test/';
        viewer.setParameter('SceneUrl', PATH_TO_MODELS + 'jsc_logo.obj');
        viewer.setParameter('InitRotationX', 20);
        viewer.setParameter('InitRotationY', 20);
        viewer.setParameter('InitRotationZ', 0);
        viewer.setParameter('ModelColor', '#CAA618');
        viewer.setParameter('ModelColor', '#CAA618');
        viewer.setParameter('BackgroundColor1', '#000000');
        viewer.setParameter('BackgroundColor2', '#6A6AD4');
        viewer.setParameter('BackgroundImageUrl', '{{ STATIC_URL }}/meshviewer/img/graphy/graphy_@2X.png');
        viewer.setParameter('RenderMode', 'points');
        viewer.setParameter('SphereMapUrl', PATH_TO_MODELS + 'chrome.jpg');
        viewer.setParameter('ProgressBar', 'off');
        viewer.init();
        viewer.update();

        viewer.enableDefaultInputHandler(false);
        logoTimerID = setInterval( function() { 
            viewer.rotate(0, 10, 0);
            viewer.update();
        }, 100);
        setTimeout( function() {
            viewer.enableDefaultInputHandler(true); 
            if(logoTimerID > 0)
            loadModel();
        }, 8000);

        viewer.onloadingstarted = function() {
            displayUserDefinedProgressBar(true);
        };

        viewer.onloadingcomplete = viewer.onloadingaborted = viewer.onloadingerror = function() {
            displayUserDefinedProgressBar(false);
        };

        var ctx = canvas.getContext('2d');
        ctx.font = '12px Courier New';
        ctx.fillStyle = '#FF0000';
        viewer.afterupdate = function() {
            if(logoTimerID > 0)
            return;

            var scene = viewer.getScene();
            if(scene != null && scene.getChildren().length > 0) {
            var objects = scene.getChildren();
            var totalFaceCount = 0;
            var totalVertexCount = 0
            for(var i=0; i<objects.length; i++) {
                totalFaceCount += objects[i].faceCount;
                totalVertexCount += objects[i].vertexBuffer.length / 3;
            }
            ctx.fillText(totalVertexCount.toString() + ' vertices', 10, 20);
            ctx.fillText(totalFaceCount.toString() + ' faces', 10, 35);
            }
        };

        function loadModel() {
            if(logoTimerID > 0) {
            clearInterval(logoTimerID);
            logoTimerID = 0;
            viewer.enableDefaultInputHandler(true);
            }
            var models = document.getElementById('model_list');
            viewer.replaceSceneFromUrl(PATH_TO_MODELS + models[models.selectedIndex].innerHTML);
            viewer.update();
        }

        function setRenderMode() {
            if(logoTimerID > 0)
            return;
            var modes = document.getElementById('render_mode_list');
            switch(modes.selectedIndex) {
            case 0:
            viewer.setRenderMode('point');
            JSC3D.console.logInfo('Set to point mode.');
            break;
            case 1:
            viewer.setRenderMode('wireframe');
            JSC3D.console.logInfo('Set to wireframe mode.');
            break;
            case 2:
            viewer.setRenderMode('flat');
            JSC3D.console.logInfo('Set to flat mode.');
            break;
            case 3:
            viewer.setRenderMode('smooth');
            JSC3D.console.logInfo('Set to smooth mode.');
            break;
            case 4:
            viewer.setRenderMode('texturesmooth');
            var scene = viewer.getScene();
            if(scene) {
                var objects = scene.getChildren();
                for(var i=0; i<objects.length; i++)
                objects[i].isEnvironmentCast = true;
            }
            JSC3D.console.logInfo('Set to environment-mapping mode.');
            break;
            default:
            viewer.setRenderMode('flat');
            break;
            }
            viewer.update();
        }

        /*
        *  Create a user-defined progress bar.
        */
        /*
        var sonic = new Sonic({
            width: 300, 
            height: 50, 
            stepsPerFrame: 1, 
            trailLength: 0.6, 
            pointDistance: .0333, 
            fps: 10, 
            padding: 5, 
            fillColor: '#95952B', 
            setup: function() {
            this._.lineWidth = 20;
            }, 
            path: [
            ['line', 0, 20, 300, 20],
            ['line', 300, 20, 0, 20]
            ]
        });
        document.getElementById('loading').appendChild(sonic.canvas);

        function displayUserDefinedProgressBar(show) {
            if(show) {
            sonic.play();
            document.getElementById('loading').style.display = 'block';
            }
            else {
            sonic.stop();
            document.getElementById('loading').style.display = 'none';
            }
        }
        */
        </script>



            </div>
        </div>
    </div>


